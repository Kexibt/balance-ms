# Тестовое задание на позицию стажера-бекендера

## Микросервис для работы с балансом пользователей.

### Старт приложения
Команда ```make docker-build``` запустит сборку docker-compose после чего приложение будет доступно по адресу 0.0.0.0:8000 (можно изменить в config.yml, но тогда нужно дополнительно пробрасывать в докере). Также есть команда для старта без докера ```make run-no-docker```(не рекомендуется)

### Решенные задачи
Реализованы следующие методы:
* Метод начисления и списания средств. Принимает id пользователя и сколько средств зачислить/списать.
* Метод перевода средств от пользователя к пользователю. Принимает id пользователя с которого нужно списать средства, id пользователя которому должны зачислить средства, а также сумму.
* Метод получения текущего баланса пользователя в любой доступной* валюте. Принимает id пользователя. Баланс всегда в рублях.
* Развернут docker compose (сначала из Dockerfile собирается image, после собирается docker-compose)

### Особенности
1. Методы начисления и списания можно объеденены в один.
2. По умолчанию сервис не содержит в себе никаких данных о балансах. При первом запуске баланс всех пользователей 0р и в бд, и в приложении. В случае рестартов приложения данные не восстанавливаются, так как в задании не было указано(либо я не совсем понял), что делать в данном случае.
3. Данные о курсах валют берутся не с рекомендованного https://exchangeratesapi.io/, а с https://open.er-api.com/v6/latest/, так как мой api token не имеет доступа/заблокирован
4. В папке "useful\ files" находятся sql и postman файлы

## Взаимодействие
В папке "useful\ files" находится collection postman для более удобного просмотра кейсов использования 

### Просмотр баланса пользователя
Требуется отправить GET запрос на host:port/get_balance. ID пользователя и в какой валюте выводить баланс передается через параметры запроса, id - ID, currency - валюта.

#### Особенности
* Количество передаваемых ID не ограничено.
* Первые n параметров currency будут применены к первым n запросам параметров id

#### Пример
>GET 127.0.0.1:8000/get_balance?id=user1_test&currency=RUB&id=user2_test&id=user3_test&currency=EUR

RESPONSE:
```json
{
    "user1_test": 3000,
    "user2_test": 221.9,
    "user3_test": 0
}
```

### Изменение баланса пользователя
Требуется отправить POST запрос на host:port/add_balance. В поле from задается ID пользователя, кому будут начислены/списаны средства. В поле amount сумма. Если сумма отрицательно спишется абсолютная величина этой суммы.

#### Особенности
* Количество передаваемых запросов на перевод не ограничено (можно отправить один запрос, содержащий данные для нескольких пополнений).

#### Пример
>POST 127.0.0.1:8000/add_balance

BODY: 
```json : 
[
    {
        "id":"user2_test",
        "amount":2500
    },
    {
        "id":"user1_test",
        "amount":1500
    }
]
```
RESPONSE:
```json
[
    {
        "result ->user2_test": {
            "balance": 12500
        }
    },
    {
        "result ->user1_test": {
            "balance": 3000
        }
    },
    {
        "error ->user3_test": "у пользователя user3_test недостаточно средств"
    }
]
```

### Перевод с баланса на баланс
Требуется отправить POST запрос на host:port/transfer_balance. В поле from задается ID пользователя, с чьего баланса будут списаны средства, в поле to - ID пользователя начисления средств

#### Особенности
* Количество передаваемых запросов на перевод не ограничено (можно отправить один запрос, содержащий данные для нескольких переводов).

#### Пример
>POST 127.0.0.1:8000/transfer_balance

BODY: 
```json : 
[{
    "from":"user2_test",
    "to":"user1_test",
    "amount":4000
},{
    "from":"user1_test",
    "to":"user2_test",
    "amount":3000
},{
    "from":"user1_test",
    "to":"user2_test",
    "amount":1500
},{
    "from":"user1_test",
    "to":"user2_test",
    "amount":1000
}
]
```
RESPONSE:
```json
[
    {
        "result user2_test->user1_test": {
            "balance user1_test": 7000,
            "balance user2_test": 8500
        }
    },
    {
        "result user1_test->user2_test": {
            "balance user1_test": 4000,
            "balance user2_test": 11500
        }
    },
    {
        "result user1_test->user2_test": {
            "balance user1_test": 2500,
            "balance user2_test": 13000
        }
    },
    {
        "result user1_test->user2_test": {
            "balance user1_test": 1500,
            "balance user2_test": 14000
        }
    }
]
```
